<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loading-overlay { background: rgba(255,255,255,0.9); display: none; position: fixed; inset: 0; z-index: 9999; align-items: center; justify-content: center; flex-direction: column; }
        .toggle-checkbox:checked { right: 0; border-color: #68D391; }
        .toggle-checkbox:checked + .toggle-label { background-color: #68D391; }
        .nav-active { background-color: #f97316; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .slide-up { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .toast-anim { animation: slideIn 0.5s ease-out forwards; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .bell-ring { animation: ring 1s infinite ease-in-out; }
        @keyframes ring { 0% { transform: rotate(0); } 10% { transform: rotate(30deg); } 30% { transform: rotate(-28deg); } 50% { transform: rotate(34deg); } 70% { transform: rotate(-32deg); } 90% { transform: rotate(30deg); } 100% { transform: rotate(0); } }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 font-sans h-screen flex overflow-hidden">

    <audio id="notif-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" loop></audio>

    <div id="notification-toast" class="fixed top-5 right-5 z-[100] hidden transition-transform hover:scale-105">
        <div class="relative bg-red-600 text-white shadow-2xl rounded-xl p-4 flex items-center toast-anim min-w-[320px] border-4 border-white cursor-pointer" onclick="openNewOrderModal()">
            <button onclick="closeToast(event)" class="absolute -top-3 -right-3 bg-white text-red-600 border-2 border-red-600 rounded-full w-8 h-8 flex items-center justify-center shadow-lg hover:bg-red-50 z-50 transition">
                <i class="fas fa-times text-lg font-bold"></i>
            </button>
            <div class="bg-white rounded-full p-3 mr-4">
                <i class="fas fa-bell text-red-600 text-2xl bell-ring"></i>
            </div>
            <div>
                <h4 class="font-bold text-lg">‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤!</h4>
                <p class="text-sm text-red-100">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
            </div>
        </div>
    </div>

    <div id="new-order-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden z-[110] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden animate-bounce-in">
            <div class="bg-red-600 text-white p-4 text-center">
                <h3 class="text-xl font-bold"><i class="fas fa-concierge-bell mr-2"></i> ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
            </div>
            <div class="p-6 text-center">
                <div class="mb-4">
                    <p class="text-gray-500 text-sm">‡πÇ‡∏ï‡πä‡∏∞</p>
                    <p id="modal-table" class="text-4xl font-bold text-gray-800">--</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl border mb-4 text-left">
                    <p class="text-xs font-bold text-gray-400 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á:</p>
                    <p id="modal-items" class="text-lg font-bold text-gray-700 leading-relaxed">Loading...</p>
                </div>
                <div class="flex justify-between items-center border-t pt-3">
                    <span class="text-gray-500">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span>
                    <span id="modal-total" class="text-2xl font-bold text-red-600">‡∏ø0</span>
                </div>
            </div>
            <button onclick="acknowledgeOrder()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 text-lg transition">
                ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö / ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>

    <div id="loading" class="loading-overlay">
        <i class="fas fa-circle-notch fa-spin text-5xl text-orange-500 mb-4"></i>
        <p class="font-bold text-gray-600 animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <div id="login-section" class="fixed inset-0 bg-white z-[100] flex items-center justify-center">
        <div class="w-full max-w-sm p-8 text-center">
            <div class="bg-orange-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-user-shield text-4xl text-orange-500"></i>
            </div>
            <h2 class="text-3xl font-bold mb-2 text-slate-800">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ô‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏áüê∞ü§ç</h2>
            <p class="text-slate-400 mb-8">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
            <input type="password" id="admin-pin" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (1234)" class="w-full p-4 bg-gray-50 border-2 border-gray-200 rounded-2xl mb-4 text-center text-xl focus:border-orange-500 focus:outline-none transition">
            <button onclick="checkLogin()" class="w-full bg-orange-500 text-white py-4 rounded-2xl font-bold text-lg hover:bg-orange-600 shadow-lg hover:shadow-orange-200 transition transform active:scale-95">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <a href="index.html" class="block mt-6 text-gray-400 hover:text-orange-500 text-sm">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</a>
        </div>
    </div>

    <aside class="w-64 bg-white border-r hidden md:flex flex-col z-20">
        <div class="p-6 border-b">
            <h1 class="text-2xl font-bold text-orange-600"><i class="fas fa-utensils mr-2"></i>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ô‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏áüê∞ü§ç</h1>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <button onclick="switchTab('dashboard')" id="nav-dashboard" class="w-full text-left p-3 rounded-xl hover:bg-orange-50 transition flex items-center text-slate-600"><i class="fas fa-chart-line w-8"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</button>
            <button onclick="switchTab('orders')" id="nav-orders" class="w-full text-left p-3 rounded-xl hover:bg-orange-50 transition flex items-center text-slate-600"><i class="fas fa-clipboard-list w-8"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
            <button onclick="switchTab('stock')" id="nav-stock" class="w-full text-left p-3 rounded-xl hover:bg-orange-50 transition flex items-center text-slate-600"><i class="fas fa-box-open w-8"></i> ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        </nav>
        <div class="p-4 border-t">
            <div class="px-3 py-2 bg-green-50 rounded-lg mb-4 border border-green-200">
                <div class="flex items-center text-green-600 text-xs font-bold">
                    <span class="relative flex h-2 w-2 mr-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                </div>
            </div>
            <button onclick="logout()" class="w-full text-left p-3 rounded-xl text-red-500 hover:bg-red-50 transition flex items-center"><i class="fas fa-sign-out-alt w-8"></i> ‡∏≠‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        <header class="bg-white border-b p-4 md:hidden flex justify-between items-center z-10">
            <h1 class="font-bold text-orange-600 text-lg">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>
            <button onclick="logout()" class="text-red-500"><i class="fas fa-sign-out-alt"></i></button>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:p-8 pb-24 md:pb-8 bg-gray-50" id="main-container">
            
            <div id="view-dashboard" class="space-y-6 hidden slide-up">
                <div class="flex justify-between items-end">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h2>
                        <p class="text-slate-500 text-sm">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô</p>
                    </div>
                    <input type="date" id="dash-date" class="bg-white border p-2 rounded-lg text-sm" onchange="refreshDashboard()">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                        <h3 class="text-3xl font-bold text-green-500 mt-2">‡∏ø<span id="stat-today-total">0</span></h3>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                        <h3 class="text-3xl font-bold text-blue-500 mt-2"><span id="stat-today-count">0</span> <span class="text-sm text-gray-400 font-normal">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></h3>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                        <h3 class="text-3xl font-bold text-orange-500 mt-2">‡∏ø<span id="stat-month-total">0</span></h3>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border">
                        <h4 class="font-bold mb-4">üìà ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</h4>
                        <canvas id="chart-hourly"></canvas>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border">
                        <h4 class="font-bold mb-4">üìÖ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ)</h4>
                        <canvas id="chart-weekly"></canvas>
                    </div>
                </div>
            </div>

            <div id="view-orders" class="space-y-6 hidden slide-up">
                <div class="flex flex-col md:flex-row justify-between md:items-center gap-4 bg-white p-4 rounded-2xl shadow-sm border">
                    <div>
                        <h2 class="text-xl font-bold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
                        <p class="text-xs text-gray-400">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="text-sm font-bold text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                        <input type="date" id="order-filter-date" class="bg-gray-50 border p-2 rounded-lg text-sm focus:border-orange-500 outline-none" onchange="refreshOrders()">
                        <button onclick="refreshOrders()" class="bg-orange-100 text-orange-600 p-2 rounded-lg hover:bg-orange-200"><i class="fas fa-sync-alt"></i></button>
                    </div>
                </div>
                <div id="orders-list" class="space-y-4"></div>
            </div>

            <div id="view-stock" class="space-y-6 hidden slide-up">
                <div class="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Å</h2>
                    <button onclick="openForm()" class="bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-green-600"><i class="fas fa-plus mr-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</button>
                </div>
                <div class="flex space-x-2 overflow-x-auto no-scrollbar pb-2">
                    <button onclick="filterStock('all')" class="stock-filter active bg-orange-500 text-white px-4 py-1 rounded-full text-sm font-bold whitespace-nowrap">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button onclick="filterStock('food')" class="stock-filter bg-white text-gray-600 border px-4 py-1 rounded-full text-sm font-bold whitespace-nowrap">‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
                    <button onclick="filterStock('drink')" class="stock-filter bg-white text-gray-600 border px-4 py-1 rounded-full text-sm font-bold whitespace-nowrap">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</button>
                    <button onclick="filterStock('dessert')" class="stock-filter bg-white text-gray-600 border px-4 py-1 rounded-full text-sm font-bold whitespace-nowrap">‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô</button>
                </div>
                <div id="stock-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
            </div>

        </div>

        <div class="md:hidden fixed bottom-0 w-full bg-white border-t flex justify-around p-3 z-20 text-xs font-bold text-gray-400">
            <button onclick="switchTab('dashboard')" id="mob-dashboard" class="flex flex-col items-center gap-1"><i class="fas fa-chart-line text-lg"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</button>
            <button onclick="switchTab('orders')" id="mob-orders" class="flex flex-col items-center gap-1"><i class="fas fa-clipboard-list text-lg"></i> ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
            <button onclick="switchTab('stock')" id="mob-stock" class="flex flex-col items-center gap-1"><i class="fas fa-box-open text-lg"></i> ‡∏™‡∏ï‡πä‡∏≠‡∏Å</button>
        </div>
    </main>

    <div id="product-form" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-2xl p-6 shadow-2xl relative animate-fade-in max-h-[90vh] overflow-y-auto">
            <h3 id="form-title" class="text-xl font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <input type="hidden" id="edit-old-name">
            <div class="space-y-3">
                <input type="text" id="menu-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" class="w-full p-3 border rounded-xl">
                <div class="flex gap-2">
                    <input type="number" id="menu-price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" class="w-1/2 p-3 border rounded-xl">
                    <select id="menu-type" class="w-1/2 p-3 border rounded-xl bg-white">
                        <option value="food">‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                        <option value="drink">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                        <option value="dessert">‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô</option>
                    </select>
                </div>
                
                <div class="bg-orange-50 p-3 rounded-xl border border-orange-100">
                    <label class="flex items-center justify-between cursor-pointer mb-2">
                        <span class="font-bold text-orange-800 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å</span>
                        <div class="flex items-center">
                            <input type="checkbox" id="menu-unlimited" class="w-4 h-4 text-orange-500 rounded focus:ring-orange-500 mr-2" onchange="toggleStockInput()">
                            <span class="text-sm text-gray-600">‡∏°‡∏µ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>
                        </div>
                    </label>
                    <input type="number" id="menu-stock" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏ä‡∏¥‡πâ‡∏ô/‡∏à‡∏≤‡∏ô)" class="w-full p-3 border rounded-xl bg-white transition-all">
                </div>

                <textarea id="menu-desc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" class="w-full p-3 border rounded-xl" rows="2"></textarea>
                <div class="border-dashed border-2 border-gray-300 rounded-xl p-4 text-center cursor-pointer hover:bg-gray-50 relative">
                    <input type="file" id="menu-image" class="absolute inset-0 opacity-0 cursor-pointer">
                    <i class="fas fa-image text-gray-400 text-2xl"></i>
                    <p class="text-xs text-gray-400 mt-1">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeForm()" class="flex-1 py-3 bg-gray-200 rounded-xl font-bold text-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="saveProduct()" class="flex-1 py-3 bg-orange-500 rounded-xl font-bold text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <div id="time-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6 text-center shadow-xl">
            <h3 class="text-lg font-bold mb-4">‚è≥ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∏‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
            <div class="grid grid-cols-3 gap-3 mb-4">
                <button onclick="selectTime('10 ‡∏ô‡∏≤‡∏ó‡∏µ')" class="p-2 border rounded-lg hover:bg-orange-100">10 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
                <button onclick="selectTime('15 ‡∏ô‡∏≤‡∏ó‡∏µ')" class="p-2 border rounded-lg hover:bg-orange-100">15 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
                <button onclick="selectTime('20 ‡∏ô‡∏≤‡∏ó‡∏µ')" class="p-2 border rounded-lg hover:bg-orange-100">20 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
                <button onclick="selectTime('30 ‡∏ô‡∏≤‡∏ó‡∏µ')" class="p-2 border rounded-lg hover:bg-orange-100">30 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
                <button onclick="selectTime('45 ‡∏ô‡∏≤‡∏ó‡∏µ')" class="p-2 border rounded-lg hover:bg-orange-100">45 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
                <button onclick="selectTime('1 ‡∏ä‡∏°.')" class="p-2 border rounded-lg hover:bg-orange-100">1 ‡∏ä‡∏°.</button>
            </div>
            <button onclick="document.getElementById('time-modal').classList.add('hidden')" class="text-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwPX7-03fHsRh63WwTdLEU-RzSRUPwBpCCFVKVKDMBpiRbz-2H7L_ytpEZA17TADcWPBw/exec'; 
        const PIN = "1234";
        
        let allOrders = [];
        let allMenu = [];
        let pendingRowIndex = null;
        let chartHourly = null;
        let chartWeekly = null;
        let lastOrderCount = -1;
        let latestOrderData = null;
        let currentTab = 'dashboard'; 

        function unlockAudioContext() {
            const audio = document.getElementById('notif-sound');
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
            }).catch(e => console.log("Unlock failed"));
        }

        window.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('order-filter-date').value = today;
            document.getElementById('dash-date').value = today;
            window.addEventListener('click', unlockAudioContext, { once: true });

            if (localStorage.getItem('admin_logged_in') === 'true') {
                document.getElementById('login-section').classList.add('hidden');
                switchTab('dashboard');
                startPollingLoop(); 
            }
        });

        function startPollingLoop() {
            checkForNewOrders(); 
            setInterval(checkForNewOrders, 5000); 
        }

        async function checkForNewOrders() {
            try {
                const res = await fetch(`${SCRIPT_URL}?action=getOrders`);
                const data = await res.json();
                const currentCount = data.length - 1;

                if (lastOrderCount !== -1 && currentCount > lastOrderCount) {
                    latestOrderData = data[data.length - 1]; 
                    playAlarm();
                    showPersistentToast();
                    if (currentTab === 'orders') {
                        allOrders = data;
                        renderOrders();
                    }
                }
                lastOrderCount = currentCount;
                if(currentTab === 'orders') allOrders = data; 
            } catch (err) { console.log("Polling error:", err); }
        }

        function playAlarm() {
            const audio = document.getElementById('notif-sound');
            audio.currentTime = 0;
            audio.play().catch(e => console.log("Audio still blocked"));
        }
        function stopAlarm() {
            const audio = document.getElementById('notif-sound');
            audio.pause();
            audio.currentTime = 0;
        }
        
        function closeToast(event) {
            event.stopPropagation(); 
            document.getElementById('notification-toast').classList.add('hidden');
            stopAlarm();
        }

        function showPersistentToast() { document.getElementById('notification-toast').classList.remove('hidden'); }
        function openNewOrderModal() {
            if (!latestOrderData) return;
            document.getElementById('modal-table').innerText = latestOrderData[1];
            document.getElementById('modal-items').innerText = latestOrderData[2];
            document.getElementById('modal-total').innerText = "‡∏ø" + latestOrderData[3];
            document.getElementById('new-order-modal').classList.remove('hidden');
            document.getElementById('notification-toast').classList.add('hidden');
        }
        function acknowledgeOrder() {
            stopAlarm();
            document.getElementById('new-order-modal').classList.add('hidden');
            switchTab('orders');
        }

        function checkLogin() {
            if (document.getElementById('admin-pin').value === PIN) {
                localStorage.setItem('admin_logged_in', 'true');
                document.getElementById('login-section').classList.add('hidden');
                unlockAudioContext();
                switchTab('dashboard');
                startPollingLoop();
            } else alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");
        }
        function logout() { localStorage.removeItem('admin_logged_in'); location.reload(); }

        function switchTab(tabName) {
            currentTab = tabName; 
            ['dashboard', 'orders', 'stock'].forEach(t => document.getElementById(`view-${t}`).classList.add('hidden'));
            document.querySelectorAll('aside nav button').forEach(b => b.classList.remove('nav-active'));
            document.querySelectorAll('.md\\:hidden button').forEach(b => b.classList.remove('text-orange-500'));

            document.getElementById(`view-${tabName}`).classList.remove('hidden');
            if(document.getElementById(`nav-${tabName}`)) document.getElementById(`nav-${tabName}`).classList.add('nav-active');
            if(document.getElementById(`mob-${tabName}`)) document.getElementById(`mob-${tabName}`).classList.add('text-orange-500');

            if (tabName === 'dashboard') refreshDashboard();
            else if (tabName === 'orders') refreshOrders();
            else if (tabName === 'stock') refreshStock();
        }

        async function refreshDashboard() {
            toggleLoading(true);
            try {
                const res = await fetch(`${SCRIPT_URL}?action=getOrders`);
                allOrders = await res.json();
                lastOrderCount = allOrders.length - 1;
                renderCharts();
            } catch(e) {}
            toggleLoading(false);
        }

        function renderCharts() {
            const selectedDate = document.getElementById('dash-date').value;
            const validOrders = allOrders.slice(1);
            let todayTotal = 0, todayCount = 0, monthTotal = 0;
            let hourlySales = Array(24).fill(0);
            let weeklyLabels = [], weeklyData = [], dateMap = {};

            for(let i=6; i>=0; i--) {
                let d = new Date(); d.setDate(d.getDate() - i);
                let key = d.toISOString().split('T')[0];
                weeklyLabels.push(d.toLocaleDateString('th-TH', {weekday:'short'}));
                dateMap[key] = 0;
            }

            validOrders.forEach(row => {
                const dateObj = new Date(row[0]);
                const dateStr = dateObj.toISOString().split('T')[0];
                const amount = parseInt(row[3]) || 0;

                if (dateStr === selectedDate) {
                    todayTotal += amount; todayCount++;
                    hourlySales[dateObj.getHours()] += amount;
                }
                const selDateObj = new Date(selectedDate);
                if (dateObj.getMonth() === selDateObj.getMonth() && dateObj.getFullYear() === selDateObj.getFullYear()) {
                    monthTotal += amount;
                }
                if (dateMap.hasOwnProperty(dateStr)) dateMap[dateStr] += amount;
            });

            document.getElementById('stat-today-total').innerText = todayTotal.toLocaleString();
            document.getElementById('stat-today-count').innerText = todayCount;
            document.getElementById('stat-month-total').innerText = monthTotal.toLocaleString();
            weeklyData = Object.values(dateMap);

            if (chartHourly) chartHourly.destroy();
            chartHourly = new Chart(document.getElementById('chart-hourly').getContext('2d'), {
                type: 'bar', data: { labels: Array.from({length: 24}, (_, i) => `${i}:00`), datasets: [{ label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢', data: hourlySales, backgroundColor: '#60A5FA', borderRadius: 4 }] },
                options: { responsive: true, plugins: { legend: {display: false} } }
            });

            if (chartWeekly) chartWeekly.destroy();
            chartWeekly = new Chart(document.getElementById('chart-weekly').getContext('2d'), {
                type: 'bar', data: { labels: weeklyLabels, datasets: [{ label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô', data: weeklyData, backgroundColor: '#F97316', borderRadius: 4 }] },
                options: { responsive: true, plugins: { legend: {display: false} } }
            });
        }

        async function refreshOrders() {
            toggleLoading(true);
            try {
                const res = await fetch(`${SCRIPT_URL}?action=getOrders`);
                allOrders = await res.json();
                lastOrderCount = allOrders.length - 1;
                renderOrders();
            } catch(e) {}
            toggleLoading(false);
        }

        function renderOrders() {
            const filterDate = document.getElementById('order-filter-date').value;
            const container = document.getElementById('orders-list');
            container.innerHTML = '';
            let hasOrder = false;

            for (let i = allOrders.length - 1; i >= 1; i--) {
                const row = allOrders[i];
                const originalIndex = i - 1;
                const orderDate = new Date(row[0]).toISOString().split('T')[0];
                
                if (orderDate !== filterDate) continue; 

                hasOrder = true;
                const status = row[5] || 'waiting';
                const time = row[6] || '';
                
                let badge = `<span class="bg-yellow-100 text-yellow-600 px-3 py-1 rounded-full text-xs font-bold border border-yellow-200">‡∏£‡∏≠‡∏£‡∏±‡∏ö</span>`;
                let action = `<button onclick="openTimeModal(${originalIndex})" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm shadow font-bold hover:bg-blue-600 transition">‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>`;

                if (status === 'cooking') {
                    badge = `<span class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-xs font-bold border border-blue-200">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥ (${time})</span>`;
                    action = `<button onclick="finishOrder(${originalIndex})" class="bg-green-500 text-white px-4 py-2 rounded-lg text-sm shadow font-bold hover:bg-green-600 transition">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>`;
                } else if (status === 'completed') {
                    badge = `<span class="bg-green-100 text-green-600 px-3 py-1 rounded-full text-xs font-bold border border-green-200">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span>`;
                    action = `<span class="text-green-500 text-sm font-bold"><i class="fas fa-check"></i> ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>`;
                }

                let slipBtn = row[4].includes('http') ? `<a href="${row[4]}" target="_blank" class="text-pink-500 text-sm ml-2 bg-pink-50 px-2 py-1 rounded border border-pink-100 font-bold hover:bg-pink-100">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a>` : '';

                const html = `
                <div class="bg-white p-4 rounded-xl border shadow-sm flex flex-col md:flex-row justify-between gap-4 ${status === 'completed' ? 'opacity-60 bg-gray-50' : ''}">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="font-bold text-lg text-orange-600">‡πÇ‡∏ï‡πä‡∏∞ ${row[1]}</span>
                            <span class="text-gray-400 text-xs border px-1 rounded bg-white">${new Date(row[0]).toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'})}</span>
                            ${badge}
                            ${slipBtn}
                        </div>
                        <p class="text-sm text-gray-600 mb-1 font-medium">${row[2]}</p>
                        <p class="font-bold text-lg">‡∏ø${row[3]}</p>
                    </div>
                    <div class="flex items-center justify-end min-w-[100px]">${action}</div>
                </div>`;
                container.innerHTML += html;
            }

            if (!hasOrder) container.innerHTML = `<div class="text-center py-10 text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>`;
        }

        async function refreshStock() {
            toggleLoading(true);
            try {
                const res = await fetch(`${SCRIPT_URL}?action=getMenu`);
                allMenu = await res.json();
                renderStock();
            } catch(e) {}
            toggleLoading(false);
        }

        function filterStock(type) {
            document.querySelectorAll('.stock-filter').forEach(b => {
                b.classList.remove('bg-orange-500', 'text-white');
                b.classList.add('bg-white', 'text-gray-600');
                if((type === 'all' && b.innerText === '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') || (type === 'food' && b.innerText === '‡∏≠‡∏≤‡∏´‡∏≤‡∏£') || (type === 'drink' && b.innerText === '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°') || (type === 'dessert' && b.innerText === '‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô')) {
                    b.classList.add('bg-orange-500', 'text-white');
                    b.classList.remove('bg-white', 'text-gray-600');
                }
            });
            renderStock(type);
        }

        // üî• Render Stock Cards (‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô)
        function renderStock(type = 'all') {
            const container = document.getElementById('stock-grid');
            container.innerHTML = '';
            
            allMenu.forEach(item => {
                if (type !== 'all' && item.type !== type) return;
                const isActive = item.status === true; 
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏ï‡πä‡∏≠‡∏Å (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡∏´‡∏£‡∏∑‡∏≠ ‚àû)
                let stockDisplay = "";
                if (item.isUnlimited) {
                    stockDisplay = `<span class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs font-bold">‚àû ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>`;
                } else {
                    const stockClass = item.stock > 0 ? "bg-gray-100 text-gray-600" : "bg-red-100 text-red-600";
                    stockDisplay = `<span class="${stockClass} px-2 py-1 rounded text-xs font-bold">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.stock}</span>`;
                }

                const html = `
                <div class="bg-white border rounded-2xl p-3 shadow-sm hover:shadow-md transition relative overflow-hidden">
                    <div class="flex gap-3">
                        <img src="${item.imgUrl}" class="w-20 h-20 rounded-lg object-cover bg-gray-100 ${!isActive ? 'grayscale' : ''}">
                        <div class="flex-1 min-w-0">
                            <h4 class="font-bold text-gray-800 truncate">${item.name}</h4>
                            <p class="text-orange-500 font-bold">‡∏ø${item.price}</p>
                            <div class="flex gap-1 mt-1">
                                <span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded text-gray-500">${item.type}</span>
                                ${stockDisplay}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 flex items-center justify-between border-t pt-2">
                        <div class="flex items-center gap-2">
                            <span class="text-xs font-bold ${isActive ? 'text-green-500' : 'text-red-500'}">${isActive ? '‡∏Ç‡∏≤‡∏¢' : '‡∏´‡∏°‡∏î'}</span>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300 ${isActive ? 'right-0 border-green-400' : 'left-0 border-gray-300'}" 
                                    ${isActive ? 'checked' : ''} onclick="toggleStock('${item.name}', this)">
                                <label class="toggle-label block overflow-hidden h-5 rounded-full cursor-pointer ${isActive ? 'bg-green-400' : 'bg-gray-300'}"></label>
                            </div>
                        </div>
                        <div class="flex gap-1">
                            <button onclick='editItem(${JSON.stringify(item)})' class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteProduct('${item.name}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    ${!isActive ? '<div class="absolute inset-0 bg-white bg-opacity-30 pointer-events-none"></div>' : ''}
                </div>`;
                container.innerHTML += html;
            });
        }

        async function toggleStock(name, checkbox) {
            const newStatus = checkbox.checked;
            const label = checkbox.nextElementSibling;
            const textSpan = checkbox.parentElement.previousElementSibling;
            
            if(newStatus) {
                checkbox.classList.add('right-0', 'border-green-400'); checkbox.classList.remove('left-0', 'border-gray-300');
                label.classList.add('bg-green-400'); label.classList.remove('bg-gray-300');
                textSpan.innerText = "‡∏Ç‡∏≤‡∏¢"; textSpan.classList.add('text-green-500'); textSpan.classList.remove('text-red-500');
            } else {
                checkbox.classList.remove('right-0', 'border-green-400'); checkbox.classList.add('left-0', 'border-gray-300');
                label.classList.remove('bg-green-400'); label.classList.add('bg-gray-300');
                textSpan.innerText = "‡∏´‡∏°‡∏î"; textSpan.classList.remove('text-green-500'); textSpan.classList.add('text-red-500');
            }

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: "toggleStock", name: name, status: newStatus })
                });
            } catch(e) {
                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                checkbox.checked = !newStatus;
            }
        }

        function toggleLoading(show) { document.getElementById('loading').style.display = show ? 'flex' : 'none'; }
        
        function openTimeModal(idx) {
            pendingRowIndex = idx;
            document.getElementById('time-modal').classList.remove('hidden');
        }
        async function selectTime(t) {
            document.getElementById('time-modal').classList.add('hidden');
            await updateStatus(pendingRowIndex, 'cooking', t);
        }
        async function finishOrder(idx) {
            if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô?")) await updateStatus(idx, 'completed', '');
        }
        async function updateStatus(idx, status, time) {
            toggleLoading(true);
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "updateOrderStatus", rowIndex: idx, status: status, estTime: time }) });
            refreshOrders(); 
            toggleLoading(false);
        }

        // --- Product Form Functions ---
        function openForm() { 
            document.getElementById('product-form').classList.remove('hidden'); 
            document.getElementById('edit-old-name').value=""; 
            document.getElementById('menu-name').value=""; 
            document.getElementById('menu-price').value=""; 
            document.getElementById('menu-desc').value=""; 
            
            // Reset Stock UI
            document.getElementById('menu-stock').value = "";
            document.getElementById('menu-unlimited').checked = false;
            toggleStockInput();
        }
        
        function closeForm() { document.getElementById('product-form').classList.add('hidden'); }
        
        function editItem(item) {
            openForm();
            document.getElementById('form-title').innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤";
            document.getElementById('edit-old-name').value = item.name;
            document.getElementById('menu-name').value = item.name;
            document.getElementById('menu-price').value = item.price;
            document.getElementById('menu-type').value = item.type;
            document.getElementById('menu-desc').value = item.description || "";
            
            // Set Stock Data
            document.getElementById('menu-stock').value = item.stock;
            document.getElementById('menu-unlimited').checked = item.isUnlimited;
            toggleStockInput();
        }
        
        // Toggle disable input if unlimited
        function toggleStockInput() {
            const isUnlimited = document.getElementById('menu-unlimited').checked;
            const input = document.getElementById('menu-stock');
            if (isUnlimited) {
                input.disabled = true;
                input.classList.add('bg-gray-100', 'text-gray-400');
                input.classList.remove('bg-white');
                input.value = "";
            } else {
                input.disabled = false;
                input.classList.remove('bg-gray-100', 'text-gray-400');
                input.classList.add('bg-white');
            }
        }
        
        async function saveProduct() {
            toggleLoading(true);
            const name = document.getElementById('menu-name').value;
            const price = document.getElementById('menu-price').value;
            const oldName = document.getElementById('edit-old-name').value;
            const stock = document.getElementById('menu-stock').value;
            const isUnlimited = document.getElementById('menu-unlimited').checked;
            
            const file = document.getElementById('menu-image').files[0];
            let base64 = "";
            if(file) base64 = await toBase64(file);

            const payload = {
                action: oldName ? "updateItem" : "addItem",
                oldName: oldName,
                name: name, price: price,
                type: document.getElementById('menu-type').value,
                description: document.getElementById('menu-desc').value,
                imageFile: base64,
                stock: stock,
                isUnlimited: isUnlimited
            };
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
            closeForm();
            refreshStock();
            toggleLoading(false);
        }

        async function deleteProduct(name) {
            if(!confirm("‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ?")) return;
            toggleLoading(true);
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "deleteItem", name: name }) });
            refreshStock();
            toggleLoading(false);
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html>
