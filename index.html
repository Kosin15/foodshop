<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Quick Order</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .loading-shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        /* ‡∏ã‡πà‡∏≠‡∏ô Scrollbar ‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-full shadow-2xl text-white font-bold hidden transition-all duration-300">
        <span id="toast-msg"></span>
    </div>

    <nav class="bg-orange-500 text-white p-4 sticky top-0 z-50 shadow-md flex justify-between items-center h-16">
        <h1 id="table-display" class="text-lg font-bold">ü•ò ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡πÇ‡∏ï‡πä‡∏∞ --)</h1>
        <div class="flex items-center space-x-5">
            <button onclick="loadMenu()" class="text-white hover:rotate-180 transition duration-500">
                <i class="fas fa-sync-alt"></i>
            </button>
            <a href="admin.html" class="text-white hover:opacity-80 transition text-xl">
                <i class="fas fa-user-cog"></i>
            </a>
        </div>
    </nav>

    <div class="sticky top-16 z-40 bg-gray-50/95 backdrop-blur-sm py-3 border-b shadow-sm">
        <div class="flex space-x-3 px-4 overflow-x-auto no-scrollbar whitespace-nowrap max-w-md mx-auto">
            <button onclick="filterMenu('all')" class="filter-btn bg-orange-500 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-md transition-all border border-transparent" data-type="all">
                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <button onclick="filterMenu('food')" class="filter-btn bg-white text-gray-600 px-4 py-1.5 rounded-full text-sm font-bold shadow-sm border border-gray-200 hover:bg-orange-50 transition-all" data-type="food">
                üç≤ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£
            </button>
            <button onclick="filterMenu('drink')" class="filter-btn bg-white text-gray-600 px-4 py-1.5 rounded-full text-sm font-bold shadow-sm border border-gray-200 hover:bg-blue-50 transition-all" data-type="drink">
                ü•§ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°
            </button>
            <button onclick="filterMenu('dessert')" class="filter-btn bg-white text-gray-600 px-4 py-1.5 rounded-full text-sm font-bold shadow-sm border border-gray-200 hover:bg-pink-50 transition-all" data-type="dessert">
                üç∞ ‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô
            </button>
        </div>
    </div>

    <div class="p-4 max-w-md mx-auto pb-32 min-h-screen">
        
        <div id="section-food" class="mb-8 section-group animate-fade-in">
            <h2 class="text-xl font-bold mb-4 text-orange-600 flex items-center border-b pb-2">
                <i class="fas fa-utensils mr-2"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£
            </h2>
            <div id="food-list" class="space-y-4">
                <div class="loading-shimmer h-24 rounded-xl w-full"></div>
            </div>
        </div>

        <div id="section-drink" class="mb-8 border-t pt-6 section-group animate-fade-in">
            <h2 class="text-xl font-bold mb-4 text-blue-600 flex items-center border-b pb-2">
                <i class="fas fa-glass-whiskey mr-2"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°
            </h2>
            <div id="drink-list" class="space-y-4">
                <div class="loading-shimmer h-24 rounded-xl w-full"></div>
            </div>
        </div>

        <div id="section-dessert" class="mb-8 border-t pt-6 section-group animate-fade-in">
            <h2 class="text-xl font-bold mb-4 text-pink-500 flex items-center border-b pb-2">
                <i class="fas fa-birthday-cake mr-2"></i> ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô
            </h2>
            <div id="dessert-list" class="space-y-4">
                <div class="loading-shimmer h-24 rounded-xl w-full"></div>
            </div>
        </div>

        <div id="empty-msg" class="hidden text-center py-20 text-gray-400">
            <i class="fas fa-search text-4xl mb-2"></i>
            <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ</p>
        </div>
    </div>

    <div id="cart-bar" class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 shadow-[0_-4px_10px_rgba(0,0,0,0.1)] hidden z-50">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div class="flex items-center">
                <div class="relative mr-4">
                    <i class="fas fa-shopping-basket text-orange-500 text-2xl"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full border-2 border-white">0</span>
                </div>
                <p class="text-xl font-bold text-orange-600">‡∏ø<span id="cart-total">0</span></p>
            </div>
            <button onclick="sendOrder(event)" class="bg-green-500 text-white px-8 py-3 rounded-xl font-bold hover:bg-green-600 transition shadow-lg">
                ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢!
            </button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwPX7-03fHsRh63WwTdLEU-RzSRUPwBpCCFVKVKDMBpiRbz-2H7L_ytpEZA17TADcWPBw/exec'; 
        let cart = [];
        let total = 0;
        const urlParams = new URLSearchParams(window.location.search);
        const tableNumber = urlParams.get('table') || "00";

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('table-display').innerText = `ü•ò ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡πÇ‡∏ï‡πä‡∏∞ ${tableNumber})`;
            loadMenu();
        });

        // ‚≠ê ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (‡πÉ‡∏´‡∏°‡πà)
        function filterMenu(type) {
            // 1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏° (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏î)
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.type === type) {
                    // ‡∏õ‡∏∏‡πà‡∏° Active
                    btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                    btn.classList.add('bg-orange-500', 'text-white', 'border-transparent', 'shadow-md');
                } else {
                    // ‡∏õ‡∏∏‡πà‡∏° Inactive
                    btn.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                    btn.classList.remove('bg-orange-500', 'text-white', 'border-transparent', 'shadow-md');
                }
            });

            // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Section
            const sections = {
                'food': document.getElementById('section-food'),
                'drink': document.getElementById('section-drink'),
                'dessert': document.getElementById('section-dessert')
            };

            let hasItem = false;

            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏≠‡∏±‡∏ô‡πÑ‡∏´‡∏ô
            for (const [key, el] of Object.entries(sections)) {
                if (type === 'all' || type === key) {
                    el.classList.remove('hidden');
                    
                    // ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏µ‡∏î‡∏Ñ‡∏±‡πà‡∏ô (border-t) ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏°‡∏ß‡∏î
                    if (type !== 'all') el.classList.remove('border-t', 'pt-6'); 
                    else if (key !== 'food') el.classList.add('border-t', 'pt-6'); // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å all

                    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡πÑ‡∏´‡∏° (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ div ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)
                    if (el.querySelector('div').children.length > 0) hasItem = true;
                } else {
                    el.classList.add('hidden');
                }
            }

            // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ä‡∏±‡∏î‡πÜ
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function loadMenu() {
            try {
                const response = await fetch(SCRIPT_URL + "?action=getMenu");
                const menuItems = await response.json();
                
                const foodList = document.getElementById('food-list');
                const drinkList = document.getElementById('drink-list');
                const dessertList = document.getElementById('dessert-list');

                foodList.innerHTML = '';
                drinkList.innerHTML = '';
                dessertList.innerHTML = '';

                if (menuItems.length === 0) return;

                menuItems.forEach(item => {
                    let btnColor = 'bg-orange-500';
                    let priceColor = 'text-orange-600';
                    if (item.type === 'drink') { btnColor = 'bg-blue-500'; priceColor = 'text-blue-600'; }
                    else if (item.type === 'dessert') { btnColor = 'bg-pink-500'; priceColor = 'text-pink-500'; }

                    const card = `
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden flex border border-gray-100 transition hover:shadow-md animate-fade-in">
                            <img src="${item.imgUrl}" class="w-24 h-24 object-cover" onerror="this.src='https://placehold.co/200x200?text=No+Image'">
                            <div class="p-3 flex-1 flex flex-col justify-between">
                                <div>
                                    <h3 class="font-bold text-gray-800 text-sm leading-tight">${item.name}</h3>
                                    <p class="text-gray-400 text-[10px] mt-1 line-clamp-1">${item.description || ''}</p>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-bold ${priceColor}">‡∏ø${item.price}</span>
                                    <button onclick="addToCart('${item.name}', ${item.price})" class="${btnColor} text-white px-3 py-1 rounded-full text-xs active:scale-90 transition shadow-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                </div>
                            </div>
                        </div>`;
                    
                    if(item.type === 'food') foodList.innerHTML += card;
                    else if (item.type === 'drink') drinkList.innerHTML += card;
                    else if (item.type === 'dessert') dessertList.innerHTML += card;
                });

            } catch (e) {
                showToast("‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï", false);
            }
        }

        function addToCart(name, price) {
            cart.push({name, price});
            total += price;
            updateUI();
        }

        function updateUI() {
            const bar = document.getElementById('cart-bar');
            bar.classList.toggle('hidden', cart.length === 0);
            document.getElementById('cart-count').innerText = cart.length;
            document.getElementById('cart-total').innerText = total;
        }

        function showToast(msg, isSuccess) {
            const toast = document.getElementById('toast');
            toast.className = `fixed top-5 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-full shadow-2xl text-white font-bold transition-all duration-300 ${isSuccess ? 'bg-green-500' : 'bg-red-500'}`;
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        async function sendOrder(event) {
            const btn = event.target;
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
            btn.disabled = true;

            const orderData = {
                table: tableNumber,
                menuItems: cart.map(item => item.name).join(", "),
                totalPrice: total
            };

            try {
                const response = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(orderData) });
                const result = await response.json();
                if (result.result === "success") {
                    showToast("‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!", true);
                    cart = []; total = 0; updateUI();
                }
            } catch (e) {
                showToast("‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", false);
            } finally {
                btn.innerText = "‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢!";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
